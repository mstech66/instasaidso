<!DOCTYPE html>
<html>

<head>
    <title>Insta Said So!</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script>
        window.$ = window.jQuery = require('../public/javascripts/jquery.min.js');
    </script>
    <link rel="stylesheet" href="../public/stylesheets/style.css">
    <link rel="stylesheet" href="../public/stylesheets/ispinner.css">
    <link rel="stylesheet" href="../public/stylesheets/bootstrap.min.css">
    <link href="../public/stylesheets/material-components-web.min.css" rel="stylesheet">
    <script src="../public/javascripts/material-components-web.min.js"></script>
    <script src="../public/javascripts/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
</head>

<body>
    <div class="splash">
        <h1 class="splash-title">InstaSaidSo!</h1>
        <div class="ispinner white animating">
            <div class="ispinner-blade"></div>
            <div class="ispinner-blade"></div>
            <div class="ispinner-blade"></div>
            <div class="ispinner-blade"></div>
            <div class="ispinner-blade"></div>
            <div class="ispinner-blade"></div>
            <div class="ispinner-blade"></div>
            <div class="ispinner-blade"></div>
            <div class="ispinner-blade"></div>
            <div class="ispinner-blade"></div>
            <div class="ispinner-blade"></div>
            <div class="ispinner-blade"></div>
        </div>
    </div>
    <div class="acrylic">
        <div class="container">
            <div class="post-pane">
            </div>
        </div>
    </div>
    <div class="side-pane">
        <button type="button" class="btn btn-light">Push Notification</button>
    </div>
</body>


<script type="text/javascript">
    const svgLike = "M 34.6 6.1 c 5.7 0 10.4 5.2 10.4 11.5 c 0 6.8 -5.9 11 -11.5 16 S 25 41.3 24 41.9 c -1.1 -0.7 -4.7 -4 -9.5 -8.3 c -5.7 -5 -11.5 -9.2 -11.5 -16 C 3 11.3 7.7 6.1 13.4 6.1 c 4.2 0 6.5 2 8.1 4.3 c 1.9 2.6 2.2 3.9 2.5 3.9 c 0.3 0 0.6 -1.3 2.5 -3.9 c 1.6 -2.3 3.9 -4.3 8.1 -4.3 m 0 -3 c -4.5 0 -7.9 1.8 -10.6 5.6 c -2.7 -3.7 -6.1 -5.5 -10.6 -5.5 C 6 3.1 0 9.6 0 17.6 c 0 7.3 5.4 12 10.6 16.5 c 0.6 0.5 1.3 1.1 1.9 1.7 l 2.3 2 c 4.4 3.9 6.6 5.9 7.6 6.5 c 0.5 0.3 1.1 0.5 1.6 0.5 c 0.6 0 1.1 -0.2 1.6 -0.5 c 1 -0.6 2.8 -2.2 7.8 -6.8 l 2 -1.8 c 0.7 -0.6 1.3 -1.2 2 -1.7 C 42.7 29.6 48 25 48 17.6 c 0 -8 -6 -14.5 -13.4 -14.5 Z";
    const svgUnlike = "M34.6 3.1c-4.5 0-7.9 1.8-10.6 5.6-2.7-3.7-6.1-5.5-10.6-5.5C6 3.1 0 9.6 0 17.6c0 7.3 5.4 12 10.6 16.5.6.5 1.3 1.1 1.9 1.7l2.3 2c4.4 3.9 6.6 5.9 7.6 6.5.5.3 1.1.5 1.6.5s1.1-.2 1.6-.5c1-.6 2.8-2.2 7.8-6.8l2-1.8c.7-.6 1.3-1.2 2-1.7C42.7 29.6 48 25 48 17.6c0-8-6-14.5-13.4-14.5z";

    let reachedEnd = false;

    $(document).ready(function() {
        let count = 5;
        while (count != 0) {
            getQuote(count);
            count--;
        }
        $(window).scroll(function() {
            if ($(window).scrollTop() + $(window).height() > $(document).height() - 10) {
                if (reachedEnd) {
                    console.log("Reached the end!!");
                } else {
                    getQuote(2);
                }
            }
        });
    });



    function like(button, svg, path) {
        button.style.animation = "";
        button.style.animation = "unlike 100ms ease-out 2 alternate";
        path.setAttribute("d", svgUnlike);
        svg.setAttribute("fill", "#ed4956");
        svg.setAttribute("aria-label", "Unlike");
    }

    function unlike(button, svg, path) {
        button.style.animation = "";
        button.style.animation = "like 100ms ease-in 2 alternate";
        path.setAttribute("d", svgLike);
        svg.setAttribute("fill", "#262626");
        svg.setAttribute("aria-label", "Like");
    }

    function setDoubleClickListener() {
        $('#heart').fadeOut("fast");
        $('.igContainer').dblclick(function() {
            $('#heart').fadeIn("fast");
            $('#heart').addClass("pound");
            setTimeout(() => {
                $('#heart').removeClass("pound");
                $('#heart').fadeOut("slow");
            }, 500);
            like();
        });
    }

    function showLoader() {
        let loaderBlock = `
        <div class="ispinner gray animating">
            <div class="ispinner-blade"></div>
            <div class="ispinner-blade"></div>
            <div class="ispinner-blade"></div>
            <div class="ispinner-blade"></div>
            <div class="ispinner-blade"></div>
            <div class="ispinner-blade"></div>
            <div class="ispinner-blade"></div>
            <div class="ispinner-blade"></div>
            <div class="ispinner-blade"></div>
            <div class="ispinner-blade"></div>
            <div class="ispinner-blade"></div>
            <div class="ispinner-blade"></div>
        </div>
        `;
    }

    function getQuote(index) {
        $.get("http://localhost:3000/", function(data, status) {
            console.log(`${data.text} and ${data.id} and length is ${data.length}`);
            if (data.id == -1) {
                reachedEnd = true;
                return;
            }
            let igContainer = `
            <div class="igContainer" ondblclick="setDoubleTapListener('${data.id}')">
                <div class="header">
                    <div class="avatar"></div>
                    <p id="author">${data.author}</p>
                    <button class="mdc-icon-button material-icons" id="more">more_vert</button>
                </div>
                <div id="heart_${data.id}" class="heart hiddenHeart">
                    <svg fill="#fafafa" fill-opacity="0.9" height="100" viewBox="0 0 48 48">
                        <path id="heartPath" d="${svgUnlike}"></path>
                    </svg>
                </div>
                <div class="quoteData">
                    <p id="quote">${data.text}</p>
                </div>
                <div class="footer">
                    <div class="buttons">
                        <button class="likeButton" id="post_${data.id}" onclick="setLikeListener('post_${data.id}', false)">
                            <svg id="likeSvg" class="likeSvg" aria-label="Like" fill="#262626" height="24" viewBox="0 0 48 48"
                                width="24">
                                <path id="likePath" d="${svgLike}">
                                </path>
                            </svg>
                        </button>
                        <svg aria-label="Share Post" class="_8-yf5 " fill="#262626" height="24" viewBox="0 0 48 48"
                            width="24">
                            <path
                                d="M46.5 3.5h-45C.6 3.5.2 4.6.8 5.2l16 15.8 5.5 22.8c.2.9 1.4 1 1.8.3L47.4 5c.4-.7-.1-1.5-.9-1.5zm-40.1 3h33.5L19.1 18c-.4.2-.9.1-1.2-.2L6.4 6.5zm17.7 31.8l-4-16.6c-.1-.4.1-.9.5-1.1L41.5 9 24.1 38.3z">
                            </path>
                            <path d="M14.7 48.4l2.9-.7"></path>
                        </svg>
                        <svg id="bookmark" aria-label="Save" class="_8-yf5 " fill="#262626" height="24"
                            viewBox="0 0 48 48" width="24">
                            <path
                                d="M43.5 48c-.4 0-.8-.2-1.1-.4L24 29 5.6 47.6c-.4.4-1.1.6-1.6.3-.6-.2-1-.8-1-1.4v-45C3 .7 3.7 0 4.5 0h39c.8 0 1.5.7 1.5 1.5v45c0 .6-.4 1.2-.9 1.4-.2.1-.4.1-.6.1zM24 26c.8 0 1.6.3 2.2.9l15.8 16V3H6v39.9l15.8-16c.6-.6 1.4-.9 2.2-.9z">
                            </path>
                        </svg>
                    </div>
                </div>
            </div>
            `;
            $('.post-pane').append(igContainer);
            $('.splash').remove();
            $('body').css("overflow-y", "scroll");
        });
    }


    $('#refresh').on('click', function(event) {
        event.preventDefault();
        $.get("http://localhost:3000/reload", function(data, status) {
            console.log("Refreshed App...");
        });
    });
</script>

<script defer>
    //the script has to execute when dom is fully loaded

    function setLikeListener(id, doubleClick) {
        let button = document.getElementById(id);
        let childSvg = button.querySelector('#likeSvg');
        let childPath = childSvg.querySelector('#likePath');
        if (doubleClick == true) {
            like(button, childSvg, childPath);
        } else {
            if (childSvg.getAttribute('aria-label') == 'Like') {
                like(button, childSvg, childPath);
            } else {
                unlike(button, childSvg, childPath);
            }
        }

    }

    function getSvgInsideButton(id) {
        let childSvg = document.getElementsByClassName('likeSvg');
        let parent = childSvg ? childSvg.parentNode : {};
        return (parent.id && parent.id == id) ? childSvg : {};
    }

    function setDoubleTapListener(id) {
        let heart = document.getElementById(`heart_${id}`);
        heart.classList.add('pound');
        heart.classList.remove('hiddenHeart');
        setTimeout(() => {
            heart.classList.remove("pound");
            heart.classList.add('hiddenHeart')
        }, 800);
        setLikeListener(`post_${id}`, true);
    }
</script>

</html>